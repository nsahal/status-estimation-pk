name: Inject Custom CSS
on:
  workflow_run:
    workflows: ["Static Site CI"]
    types:
      - completed

jobs:
  inject-css:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Checkout gh-pages
        uses: actions/checkout@v4
        with:
          ref: gh-pages
          token: ${{ secrets.GH_PAT || github.token }}
      
      - name: Inject custom CSS and remove footer
        run: |
          # Add custom CSS link to index.html before </head>
          sed -i 's|</head>|<link href=https://status.estimation.pk/custom.css rel=stylesheet></head>|' index.html
          
          # Completely remove the footer element
          sed -i 's|<footer class=svelte-jbr799>.*</footer>||' index.html
          
          echo "Custom CSS injected and footer removed"
          
      - name: Commit changes
        run: |
          git config --local user.email "73812536+upptime-bot@users.noreply.github.com"
          git config --local user.name "Upptime Bot"
          git add index.html
          git diff --staged --quiet || git commit -m ":lipstick: Inject custom CSS and remove branding [skip ci]"
          
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GH_PAT || github.token }}
          branch: gh-pages
